

(function() {
var blocks = [
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, 1,-1,-1,-1, 1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1] ,
	[ 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1] ,
];
for (var y=0; y<20; y++) {
	blocks[y] = [];
	for (var x=0 ; x<300; x++) {
		var n = -1;
		// 地面
		if (y == 19) 
			n = 1;
		// ブロック
		if ((y == 15 && (x == 25 || x == 27 || x == 29))  ||
			(y == 15 && (x == 88 || x == 90)) || 
			(y == 11 && (91 <= x && x <= 98) ) || 
			(y == 11 && (102 <= x && x <= 104)) || 
			(y == 15 && x == 105) || 
			(y == 15 && (x == 111 || x == 112) ) || 
			(y == 15 && x == 129 ) || 
			(y == 11 && (132 <= x && x <= 134))  || 
			(y == 11 && (139 == x || x == 142)) ||
			(y == 15 && (x == 140 || x == 141) ) || 
			(y == 15 && (x == 179 || x == 180 || x == 182) )  )
			n = 2;
		// ? ブロック
		if ( (y == 15 && (x == 22 || x == 26 || x == 28)) || 
			 (y == 11 && x == 27) || 
			 (y == 14 && x == 72) || 
			 (y == 15 && x == 89) || 
			 (y == 11 && x == 105) || 
			 (y == 15 && (x == 117 || x == 120 || x == 123) ) || 
			 (y == 11 && x == 120) ||
		 	 (y == 11 && (x == 140 || x == 141))  || 
			 (y == 15 && x == 181 ) )
			n = 3;
		// どかん
		/* if ( ((17 <= y && y <= 18) && (x == 33 || x == 34)) || 
			 ((16 <=y && y <= 18) && (x == 47 || x == 48)) || 
			 ((15 <= y && y <=18) && (x == 61 || x == 62) ) ||
			 ((17 <= y && y <= 18)  && (x == 174 || x == 175) )  || 
			 ((17 <= y && y <= 18) && (x == 190 || x == 191) ) )
		{
			n = 1;
		} */
		var dokans = [
			[17,18,33,34] ,
			[16,18,47,48] ,
			[15,18,61,62] ,
			[17,18,174,175] ,
			[17,18,190,191] ,
		];
		dokans.forEach(function(_data) {
			if (n !== -1) 
				return;
			
			if (y == _data[0]) { 
				if (x == _data[2])
					n = 5;
				if (x == _data[3])
					n = 6;
			} else if (_data[0] < y && y <= _data[1]) {
				if (x == _data[2])
					n = 7;
				if (x == _data[3])
					n = 8;
			}
		});
		
		// かたそうなブロック
		if ( (y == 18 && ( (145 <= x && x <= 148) || (151 <= x && x <= 154) ) )  || 
			 (y == 17 && ( (146 <= x && x <= 148) || (151 <= x && x <= 153) ) )  || 
			 (y == 16 && ( (147 <= x && x <= 148) || (151 <= x && x <= 152) ) )  || 
			 (y == 15 && ( (148 <= x && x <= 148) || (151 <= x && x <= 151) ) )  || 
			 (y == 18 && ( (159 <= x && x <= 163) || (166 <= x && x <= 169) ) )  || 
			 (y == 17 && ( (160 <= x && x <= 163) || (166 <= x && x <= 168) ) )  || 
			 (y == 16 && ( (161 <= x && x <= 163) || (166 <= x && x <= 167) ) )  || 
			 (y == 15 && ( (162 <= x && x <= 163) || (166 <= x && x <= 166) ) )  || 
			 ((192 <= x && x <= 201) && (y >= 192 - x + 18) && (10 <= y && y <= 18) ) ||   
			false )
			n = 4;
		// あな
		if ( y == 19 && 
			(x == 75 || x == 76 || x == 97 || x == 98 || x == 99 || x == 164 || x == 165) )
			n = -1;
		// フラグ
		if (x == 210 && y >= 10)
			n = 1;
		
		
		blocks[y][x] = n;
	}
} 


window.MarioMap = Class.create(Map, {
	"initialize" : function() {
		Map.call(this, 16, 16);
		this.x = 0;
		this.y = 0;
		
	//	this._sf = this.createMapSurface();
	//	this.image = this._sf;
		this.image = game.assets[configs.images.map];
		
		//=== map 
		this.loadData(blocks);
		
		this.collisionData = [];
		for (var y=blocks.length-1; y>=0; y--) {
			this.collisionData[y] = [];
			for (var x=blocks[y].length-1; x>=0; x--) {
				this.collisionData[y][x] = ((blocks[y][x] > 0) ? 1 : 0);
			}
		}
	} /*, 
	"createMapSurface" : function() {
		var w = 16 , 
			h = 16; 
		var sf = new Surface(160, 16);
		
		// 0 
		//var img = game.assets[configs.images.block];
		//sf.draw(img, 0, 0, w, h, 0, 0, img.width, img.height );
		
		// 1 
		var img = game.assets[configs.images.block];
		sf.draw(img, 0, 0, img.width, img.height, w, 0, w, h );
		
		return sf;
	} */
});

})();

